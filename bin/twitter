#!/usr/bin/env node
// Regular js file for nodejs, all js syntax and APIs are available

// Remember: node uses 'require' and not 'import'
const yargs = require('yargs');
const program = require("../lib/index");

// Global variable process contain all info about the running process
// - argv: the list of arguments
// - env: environment variables
// - ...
// See: https://nodejs.org/api/process.html


const argv = yargs
  .scriptName('twitter')
  .usage('$0 [options] @twitterAccount')
  .option('key', {
    alias: 'k',
    describe: 'Twitter API key'
  })
  .option('secret', {
    alias: 's',
    describe: 'Twitter API secret'
  })
  .demandOption(['key', 'secret'], 'Please provide both key and secret')
  .check((argv) => {
    if (argv._.length !== 1) {
      throw 'Error: You must provide a twitter account';
    }
    return true;
  })
  .help()
  .argv;


program(argv._[0], argv).then((result) => {
  result.forEach(({ text, retweet_count }) => {
    console.log(`- ${text} (${retweet_count})`);
  });
  // It can be used also to execute actions over the process
  // Most common one: exit it
  process.exit(0);
});
